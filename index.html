<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juanma Dice JavaScript</title>


    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/style.css">

</head>
<body>

    <div class="container-fluid" >

        <header class="container-fluid">
            <h1>Juanma Dice</h1>
        </header>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-8">
                    <div class="alert alert-primary" role="alert" id="estado"><!-- --></div>
        
                </div>
                <div class="col-sm-2">
                    <p>Ronda # <strong id="ronda">0</strong></p>
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-primary">Empezar</button>
                </div>
            </div>
        </div>


        <div class="container-fluid" id="tablero">
            <div class="row">
                <div class="col-sm">
                    <div class="cuadro" id="cuadro-1">A</div>
                </div>
                <div class="col-sm">
                    <div class="cuadro" id="cuadro-2">B</div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="cuadro" id="cuadro-3">C</div>
                </div>
                <div class="col-sm">
                    <div class="cuadro" id="cuadro-4">D</div>
                </div>
            </div>
        </div>
    
        <footer>
            <div class="footer-copyright text-center py-3">© 2020 Copyright:
                <a href="https://github.com/ibarzabal-jm"> Juanma Ibarzabal Salles</a>
            </div>
        </footer>
    </div>
    <script>

        let secuenciaMaquina = [];
        let secuenciaUsuario = [];
        let ronda = 0;

        document.querySelector('button[type=button]').onclick = comenzarJuego;

        actualizarEstado('Tocá "Empezar" para jugar!');
        actualizarNumeroRonda('-');
        prohibirJugada();

        function comenzarJuego() {
        reiniciarJuego();
        controlRonda();
        }

        function reiniciarJuego() {
        secuenciaMaquina = [];
        secuenciaUsuario = [];
        ronda = 0;
        }

        function controlRonda() {
        actualizarEstado('Turno de la máquina');
        prohibirJugada();

        const $nuevoCuadro = obtenerCuadroAleatorio();
        secuenciaMaquina.push($nuevoCuadro);

        const RETRASO_TURNO_JUGADOR = (secuenciaMaquina.length + 1) * 1000;

        secuenciaMaquina.forEach(function($cuadro, index) {
            const RETRASO_MS = (index + 1) * 1000;
            setTimeout(function() {
            resaltar($cuadro);
            }, RETRASO_MS);
        });

        setTimeout(function() {
            actualizarEstado('Turno del jugador');
            permitirJugada();
        }, RETRASO_TURNO_JUGADOR);

        secuenciaUsuario = [];
        ronda++;
        actualizarNumeroRonda(ronda);
        }

        function manejarAccionUsuario(event) {
        const $cuadro = event.target;
        resaltar($cuadro);
        secuenciaUsuario.push($cuadro);

        const $cuadroMaquina = secuenciaMaquina[secuenciaUsuario.length - 1];
        if ($cuadro.id !== $cuadroMaquina.id) {
            perder();
            return;
        }

        if (secuenciaUsuario.length === secuenciaMaquina.length) {
            prohibirJugada();
            setTimeout(controlRonda, 1000);
        }
        }

        function obtenerCuadroAleatorio() {
        const $cuadros = document.querySelectorAll('.cuadro');
        const indice = Math.floor(Math.random() * $cuadros.length);
        return $cuadros[indice];
        }

        function actualizarNumeroRonda(ronda) {
        document.querySelector('#ronda').textContent = ronda;
        }

        function actualizarEstado(estado, error = false) {
        const $estado = document.querySelector('#estado');
        $estado.textContent = estado;
        
        if (error) {
            $estado.classList.remove('alert-primary');
            $estado.classList.add('alert-danger');
        } else {
            $estado.classList.remove('alert-danger');
            $estado.classList.add('alert-primary');
        }
        }

        function resaltar($cuadro) {
        $cuadro.style.opacity = 1;
        setTimeout(function() {
            $cuadro.style.opacity = 0.5;
        }, 500);
        }

        function prohibirJugada() {
        document.querySelectorAll('.cuadro').forEach(function($cuadro) {
            $cuadro.onclick = function() {
            };
        });
        }

        function permitirJugada() {
        document.querySelectorAll('.cuadro').forEach(function($cuadro) {
            $cuadro.onclick = manejarAccionUsuario;
        });
        }

        function perder() {
        prohibirJugada();
        actualizarEstado('Perdiste! Tocá "Empezar" para jugar de nuevo!', true);
        }







    </script>
</body>
</html>

